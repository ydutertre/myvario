My Vario (Garmin ConnectIQ) App
===============================
Usage instructions


   !!! WARNING !!! DISCLAIMER !!! WARNING !!! DISCLAIMER !!! WARNING !!!

   THIS APPLICATION IS NOT TO BE USED AS A MEAN TO INSURE FLIGHT SAFETY.

  Always follow official or recommended procedures to insure flight safety,
         *independently* from the help this application can offer.

  In particular, this application relies on barometric pressure to derive
  the altitude and MUST NOT BE USED IN A PRESSURIZED AIRCRAFT.

  WARNING: This app is intended only as an in-flight aid and should not be
  used as a primary information source. This app contains a barometric
  altimeter, it will not function in a pressurized aircraft and should
  not be used in a pressurized aircraft.â€

   !!! WARNING !!! DISCLAIMER !!! WARNING !!! DISCLAIMER !!! WARNING !!!

About touchscreen models  (no 5 button control)
-----------------------------------------------

As of version 2.20, this application has been made to support some touchscreen
models. However, use of those models can be confusing, and the watches don't
provide alert tones (so there are no vario tones, only vibrations!).
The below guide still applies, however the controls are different
- The Back button is unchanged (bottom right) and can be used to change settings
- The UP and DOWN buttons (middle left and bottom left on 5 button watches) are
replaced by SWIPE UP and SWIPE DOWN gestures on the screen
- The START button (top right on 5 button watches) is replaced by a tap on the
screen, so can be used to validate settings changes, start/stop and activity, etc.

This can become particularly counterintuitive when changing zoom and pan in the
thermal assistant/varioplot view, but it works. Log view is a bit weird as well
since to scroll through the logs, the back button and tap on screen commands are
used, while swipe up/swipe down bring to the other watch screens.


Getting Started
---------

Upon launch, the application automatically calibrates its raw pressure reading
to match the altitude detected by the watch. As such, if your watch supports maps,
it is a good idea to do a DEM Calibration at takeoff, prior to launching the app.
This is done outside of the app in the watch Settings -> Sensors and Accessories
-> Altimeter -> Calibrate -> Use DEM.

Otherwise, you will need to manually calibrate the altitude after launching My Vario,
as detailed in the Settings section.

After launching the app, if you're confused that the app is not displaying any
data, don't fret! You just need to get a GPS fix :) Go to a window or go outside,
and all will become clear.

Next is navigation. The app is geared towards watches that can be used without
a touch interface, such as Forerunner or Fenix series, although as of 2.20, best
effort support of touchscreen only models has been added (see relevant section
above in this guide).

Up button (middle left) and Down button (bottom left) can be used to go from one
view to another. Swiping up and down on a touchscreen also does the trick.

Long pressing the Up button will bring up the menu (except in the Varioplot view!
See the rest of this doc to learn more). You can navigate the menu and its various
settings with the Up, Down, Select (top right button) and Back (bottom right)
buttons. Swipes and taps also work. Check the settings and set them to what you like!

When changing settings, make sure to use the Select button to validate the change.
Pressing the back button doesn't save the setting.

The Select button can be used to start and stop the activity recording, and Back can
be used to exit the app, except during recording or in the log view.
If in log view, you want to exit the log view using UP/DOWN buttons first before you
can close the app using the back button. If the activity is recording, you want to
stop the activity first and then exit the app.

To enable Livetrack24 tracking, you need to set your username, password, and equipment
name within the settings page of the My Vario app in the Garmin Connect IQ application.
In addition you can change the frequency of the livetracking updates in the My Vario
app settings.

Foreword
--------

My Vario relies on your device's raw barometric sensor to compute the altitude,
using the ad-hoc International Civil Aviation Organization (ICAO) formulas and
according to the International Standard Atmosphere (ISA).

Upon startup, the application will read the watch altitude (if available) and
calibrate its barometer based on that. If the watch altitude was correct, then
everything is fine, and no further calibration is needed.

If, however you are unsure that your watch altitude is correct, or you know the
exact altitude of takeoff better than the watch does, you should calibrate My
Vario internal altimeter - using either the known QNH or elevation (see Settings
below) - to obtain an accurate altitude reading (besides the initial automated
calibration, the device's "native" altimeter/barometer settings are ignored).

My Vario is based on the excellent GliderSK by Cedric Dufour. If you like this
application, you should consider donating to him (see DONATE file or below).

http://cedric.dufour.name/software/donate.html

A lot of this USAGE text is also verbatim from Cedric's manual.

General View
------------

The My Vario General view displays all the flight data in a single view, without
any further bells or whistles:
 - Top-Left:
   estimated wind direction (when available)
 - Top-Right:
   estimated wind speed (when available)
 - Left:
   your current altitude
 - Center:
   your current finesse
 - Right:
   your current (GPS) heading
 - Bottom-Left:
   your current vertical speed
 - Bottom-Right:
   your current ground speed

Variometer View
---------------

The My Vario Variometer displays your current ascent/descent rate both textu-
ally and graphically, using visually appealing colors:
 - GREEN for ascent
 - RED for descent


Varioplot / Thermal Assistant View
--------------

The My Vario Varioplot / Thermal Assistant graphically displays you ascent/descent
rate along your flight path, using visually appealing colors ranging from:
 - (Bright) GREEN for maximum ascent rate
 - (Bright) RED for maximum descent rate

Unless configured otherwise, the screen will automatically switch to this view
when circling is detected, and switch back to previous view once circling is no
longer detected.

In addition, the following values will be displayed in the corner of the plot:
 - Top-Left:
   your current altitude. The color of this number indicates how much altitude
   has been gained (or lost) within the last 20 seconds: green for gains, red
   for loss, grey for (relatively) unchanged. This can be very useful in weak
   thermals.
 - Top-Right:
   your current vertical speed
 - Bottom-Left:
   your current ground speed
 - Bottom-Right:
   your current finesse

If turned on, the current thermal detected core will be displayed as a blue circle.
See "About Thermal Detection" for more details.

By pressing the MENU button (long-pressing the UP button), you will enter the
Pan/Zoom mode, where short pressing the following buttons will result in:
 - SELECT: switch between zoom in/out, pan up/down, pan left/right
 - UP:     zoom in  /OR/ pan up   /OR/ pan left
 - DOWN:   zoom out /OR/ pan down /OR/ pan right

By pressing the MENU button (long-pressing the UP button) a second time, you
will enter the Settings menu (see Settings below).

Log View
--------

My Vario Log view keeps track of your last recorded activities (global session
details; see Activity Recording below).

Use the SELECT and BACK buttons to browse through the last 100 saved entries.

The Log view is not available in flight (while recording)


Activity Recording
------------------

Controlling your activity recording status (start, pause, resume, save, discard)
is achieved by pressing the SELECT button.

My Vario adds custom fields to the recorded FIT file:
 - Barometric Altitude
 - Vertical Speed
(which will be plotted in Garmin Connect IF your installed the application
 through the Garmin ConnectIQ store)

For the entire recording session, Garmin Connect will also show the following details:
 - Distance: non-thermalling distance
 - Ascent: cumulative altitude gain and elapsed time spent ascending
 - Minimum Altitude: value and time
 - Maximum Altitude: value and time


!!!! ABOUT ALTITUDE RECORDING !!!!

Note that Garmin doesn't allow applications to overwrite default FIT fields, and as such
there will be two Altitude fields in the generated activity log: the Garmin "official"
altitude, and our (better) barometric altitude field. By default, Garmin watches
attribute pressure changes to either weather or altitude changes. This can cause the
official altitude field to be wildly incorrect compared to our barometric altitude field.

If exporting your log to gpx format and uploading to Ayvri, the Garmin altitude field will
be used (unfortunately), and this can lead to some funky issues. It is thus better to set
the altimeter to Altimeter only in the watch settings before using the application.

This can be done in Settings -> Sensors & Accessories -> Altimeter -> Sensor Mode ->
Altimeter Only.

Settings
--------

Unless explicitely stated otherwise for a given view, you may enter the Settings
menu by pressing the MENU button (long-pressing the UP button).

The application allows you to specify the following settings:

* Altimeter
  > Calibration
    - QNH:
      calibrate the altimeter using the current known QNH
    - Elevation:
      calibrate the altimeter using the current known elevation
      (QNH shall be adjusted accordingly)
  > Correction
    - Absolute:
      set the absolute device's sensor error correction
    - Relative:
      set the relative device's sensor error correction

Note: absolute and relative corrections shouldn't be needed in most cases. Check the
"calibrating device sensor" for more information.

* Variometer
  - Range:
    the range used for the variometer display (3.0, 6.0 or 9.0 m/s) and varioplot
    color range
  - Auto Thermal:
    whether the app will switch to Varioplot view automatically when circling is
    detected, and switch back once circling is no longer detected
  - Thermal Detect (EXPERIMENTAL):
    whether the app will try to detect and map a thermal in the Varioplot view
    see "About thermal detection" for more information
  - Smoothing:
    the amount of smoothing to apply to the variometer reading (determines the standard
    deviation of altitude applied to the Kalman Filter: 0.2, 0.5, 0.7, or 1.0)
  - Plot Range:
    the time range (in minutes) for plotting the variometer-vs-location history

* Sounds
  - Variometer Tones:
    whether to play variometer tones
  - Vario Vibrations:
    whether to use variometer vibrations
  - Min. Climb:
    the minimum vertical speed required to play variometer tones and/or
    vibrations
  - Min. Sink:
    the minimum sink speed required to play variometer sink tone (no vibration)
    the tone will be triggered once, each time the sink is escaped and then entered again

* Activity
  - Auto Start
    whether to automatically start the activity recording
    throughout the flight (takeoff)
  - Start Speed
    speed above which the activity automatically starts/resumes
    (must be greater than the Stop Speed; ignored if set to zero)

* General
  - Background Color:
    the background color (black or white)
  - ActiveLook:
    Set to "On" to enable HUD via ActiveLook glasses such as Engo 2. This requires an app
    restart

* Units
  - Distance:
    preferred units for displaying distance (and horizontal speed) values
  - Elevation:
    preferred units for displaying elevation (and vertical speed) values
  - Pressure:
    preferred units for displaying pressure
  - Direction:
    whether to show directions as an angle (247, 62, etc.) or as text (NW, SE, N, etc.)
  - Timezone:
    display Local Time (LT) or Universal Time Coordinates (UTC/Z)

* Livetrack
  - LT24 Frequency:
    The frequency (in seconds) at which My Vario will send a position update to Livetrack24. 
    The higher the frequency the smoother the track (one data point sent with each update).
    to the Livetrack24 server. Livetracking via Livetrack24 can also be disabled completely
    by setting this to Off.
  - STL Frequency 
    The frequency (in seconds) at which My Vario will send a position update to SportsTrackLive. 
    The frequency doesn't impact the smoothness of the track as position data points taken
    once per second are sent in batch with each update. However, because updates can be lost in
    areas with poor connectivity, I recommend a setting of 15s (so only 15 seconds worth of data
    points are lost in case of update failure). Livetracking via SportsTrackLive can also be
    disabled completely by setting this to Off.

* Storage
  - Clear logs:
    delete logs

Live Tracking
-----------------------

The application currently supports two Live Tracking services: Livetrack24 and SportsTrackLive.
They can be used at the same time for live tracking in both platforms simultaneously.

This feature requires that the watch be paired to a phone via bluetooth, and it will rely on the 
phone's Internet connection to send its position packets to the live tracking servce. This is a
win-win for the batteries involved: flight data and GPS info is done on the watch, while
connectivity is done on the phone, helping save the battery of the phone in particular.

* SportsTrackLive

If you wish to use the SportsTrackLive integration, you will need to create an account at their
website https://www.sportstracklive.com/ . Once done, you will need to go to the app settings
within the Connect IQ app to set your login email and password. You will then need to set an
update frequency within the settings of the My Vario app (default is off).

Once email, password and frequency are set, Livetracking with SportsLiveTrack will start as
soon as Activity Recording is started (either manually or via auto-start).

SportsTrackLive provides several advantages over Livetrack24:
- Modern, responsive interface
- Ayvri-like 3D visualization, both live and once flight is over
- More precise and more power efficient: while the Livetrack24 integration will only send one
GPS data point every x seconds (based on frequency setting), the SportsTrackLive integration
queues GPS points (one per second), and sends them to SportsTrackLive in batch every x seconds
(based on frequency setting). Thus, smooth tracks can be achieved with low update frequencies,
compared to Livetrack24, where high update frequency is required for smooth tracks.

* Livetrack24

If you wish to use Livetrack24 integration, you will need to create an account at their
website https://www.livetrack24.com/ . Once done, you will need to go to the app settings
within the Connect IQ app to set your login, password, and equipment name (please don't use
spaces, so something like ADVivo or AdvanceXi). You will then need to set an update frequency
within the settings of the My Vario app (default is off).

Once email, password and frequency are set, Livetracking with Livetrack24 will start as
soon as Activity Recording is started (either manually or via auto-start).

Once started, live tracking will provide position updates to Livetrack24 every X seconds, X
being a number set in the My Vario settings on the watch (please see the Settings session).
The live tracking frequency will determine the smoothness of the track (for Livetrack24).

Live tracking will automatically stop once activity recording is stopped.

About Data Filtering
--------------------

My Vario uses a Kalman Filter for Altitude and Vertical Speed. The filter
was derived from implementations in the SkyDrop vario and Arduino Open Vario.

Other values are not filtered.

The filter currently doesn't use data from the accelerometer, as gyroscope data 
is not yet available from the Garmin SDK. I am planning on adding this for System 5
devices, once SDK 4.1.0 comes out of Beta.

In general, filtered values are used.

Smoothing relies on the standard deviation of the Altitude (which depends on the
barometric sensor). This can be changed via the Variometer Smoothing setting.
Higher values of smoothing induce more lag - however, this still seems to be to
provide better reactivity for the same amount of smoothing as the original
simple moving average of GliderSK.

Note that the Minimum Climb setting can be used to compensate for weaker smoothing,
if using My Vario as an audio/vibration variometer.

However, the Activity Recorded (FIT) data are always instantaneous rather than smoothed.

About Thermal Detection
-----------------------

Thermal detection can be enabled in the settings menu, under Variometer. This feature
attempts to detect the thermal core and displays it on the Varioplot, including wind
correction.

The algorithm performs the following across the last 60 seconds of location and variometer data:
- It assigns a weight to each location. The stronger the climb at that location the higher
  the weight. However, it also decreases the weight the further that point is from the current
  altitude. The older the data point, the lower its weight as well.
- Locations with a climb rate of less than the Min. Climb setting are ignored
- It computes the weighted average of the coordinates and uses that as the thermal center
- It computes average altitude of thermal measurement as well as average thermal climb rate.
  Based on those and current altitude, if wind speed and direction are available, it computes
  a wind offset for the thermal and adds it to the thermal center computed in the previous step
- It computes at the same time the weighted standard deviation of the coordinates and uses
  that as the radius of the thermal
- It then draws the thermal as a circle in blue on the varioplot

This feature is experimental, and could be completely useless. Use at your own risk.
If you have a better algo in mind, please let me know!!

Calibrating the Device Sensor
-----------------------------

My Vario allows you to calibrate/correct your device's barometric sensor using
the following formulas:

   QFEcalibrated = QFEsensor * Crel + Cabs

Please note that this is very optional (like, extremely optional, extremely nerdy,
and wholly unnecessary). This functionality is inherited from GliderSK and is here
for people who need absolute precision in atltitude display and recording.

If you suspect your device's sensor is inaccurate, you shall:

1. install the PilotAltimeter widget to access the device's *QFE* readings
   (unfortunately, this falls out of My Vario scope/purpose)

2. take down multiple QFE readings, at different altitude, using your device's
   *raw* QFE and a reliable, calibrated, reference barometer

3. import those readings in a LibreOffice Calc (or Microsoft Excel) spreadsheet
   and obtain the Crel and Cabs coefficients by performing a linear regression:

     https://help.libreoffice.org/Calc/Regression_Analysis
     where Crel = Slope and Cabs = Intercept

   (curve-fitting for dummies: https://xkcd.com/2048/)

4. set Altimeter -> Correction -> Relative/Absolute values to the calculated
   cofficients

Not an easy feat. But if you must...